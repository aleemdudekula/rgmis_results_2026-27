<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RGMIS Admission Results</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700;800&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Poppins', sans-serif;
  background: #0f172a;
  color: white;
  min-height: 100vh;
}

.container {
  width: 95%;
  max-width: 1400px;
  margin: 12px auto;
}

/* HEADER */
.header {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 14px;
  margin-bottom: 12px;
  text-align: center;
}

.logo img {
  height: 64px;
  width: 64px;
  border-radius: 50%;
  background: white;
  padding: 4px;
}

.header h1 {
  font-size: clamp(1.2rem, 3vw, 2.4rem);
  font-weight: 800;
}

.header h1 span {
  display: block;
  font-size: clamp(1rem, 2.4vw, 1.6rem);
  font-weight: 600;
}

/* HOME BUTTONS */
.home-buttons {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin: 30px 0;
}

.home-buttons button {
  padding: 18px 30px;
  font-size: 1.1rem;
  font-weight: 700;
  border-radius: 14px;
  border: none;
  cursor: pointer;
  background: #1e40af;
  color: white;
}

.home-buttons button:hover {
  background: #2563eb;
}

/* BACK BUTTON */
.back-box {
  display: none;
  margin-bottom: 10px;
}

.back-box button {
  padding: 10px 18px;
  border-radius: 10px;
  border: none;
  font-weight: 700;
  background: #334155;
  color: white;
  cursor: pointer;
}

/* SEARCH */
.search-box {
  margin-bottom: 10px;
  display: none;
}

.search-box input {
  width: 100%;
  padding: 12px 16px;
  border-radius: 14px;
  border: none;
  font-size: 1rem;
  background: #020617;
  color: white;
}

/* TABLE */
.table-container {
  height: 78vh;
  overflow: hidden;
  border-radius: 18px;
  display: none;
}

table {
  width: 100%;
  border-collapse: collapse;
}

/* HEADER FIX */
thead {
  display: table;
  width: 100%;
  table-layout: fixed;
}

thead th {
  position: sticky;
  top: 0;
  background: #1e40af;
  padding: 14px 8px;
  z-index: 10;
}

/* BODY FIX */
tbody {
  display: block;
  padding-top: 2px;
  --scroll-duration: 60s;
  animation: autoScroll var(--scroll-duration) linear infinite;
}

tbody tr {
  display: table;
  width: 100%;
  table-layout: fixed;
}

td {
  padding: 12px 6px;
  text-align: center;
  border-bottom: 1px solid #334155;
}

/* STATUS COLORS */
.granted  { color: #10b981; font-weight: 800; }
.rejected { color: #ef4444; font-weight: 800; }
.pending  { color: #f59e0b; font-weight: 800; }

/* SCROLL */
@keyframes autoScroll {
  from { transform: translateY(0); }
  to   { transform: translateY(-50%); }
}
</style>
</head>

<body>

<div class="container">

  <!-- HEADER -->
  <div class="header">
    <div class="logo">
      <img src="logo rgmis.jpg" alt="Logo">
    </div>
    <h1>
      RGM INTERNATIONAL SCHOOL, NANDYAL
      <span>Admission Test Results 2026–2027</span>
    </h1>
  </div>

  <!-- HOME -->
  <div class="home-buttons" id="home">
    <button onclick="loadResults('1_6')">Results : Classes 1 – 6</button>
    <button onclick="loadResults('7_11')">Results : Classes 7 – 11</button>
  </div>
  <div class="result-note" id="resultNote">
    Results will be displayed from <strong>12:30 PM onwards</strong>
  </div>

  <!-- BACK -->
  <div class="back-box" id="backBox">
    <button onclick="goHome()">← Back to Home</button>
  </div>

  <!-- SEARCH -->
  <div class="search-box" id="searchBox">
    <input type="text" id="searchInput" placeholder="Search by Name / Result">
  </div>

  <!-- TABLE -->
  <div class="table-container" id="tableBox">
    <table>
      <thead>
        <tr>
          <th>S.No</th>
          <th>Name</th>
          <th>B/DB</th>
          <th>Admission Into</th>
          <th>Results</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

</div>

<script>
/* GOOGLE SHEET CSV LINKS */
const SHEET_1_6 =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRqHwSUqfM3N4HzVlc21Cf1Ua7bhQdRwFJ4Bt-BagAui4ZzSFSJEYJ7DTTXMqLZmnnFvpmLi7CYuyUL/pub?gid=0&single=true&output=csv";

const SHEET_7_11 =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRqHwSUqfM3N4HzVlc21Cf1Ua7bhQdRwFJ4Bt-BagAui4ZzSFSJEYJ7DTTXMqLZmnnFvpmLi7CYuyUL/pub?gid=264663954&single=true&output=csv";

let excelUrl = "";
const tbody = document.getElementById("tbody");
let allRows = [];

/* LOAD RESULTS */
function loadResults(type) {
  excelUrl = type === "1_6" ? SHEET_1_6 : SHEET_7_11;

  document.getElementById("home").style.display = "none";
  document.getElementById("backBox").style.display = "block";
  document.getElementById("searchBox").style.display = "block";
  document.getElementById("tableBox").style.display = "block";

  fetchData();
}

/* GO HOME */
function goHome() {
  document.getElementById("home").style.display = "flex";
  document.getElementById("backBox").style.display = "none";
  document.getElementById("searchBox").style.display = "none";
  document.getElementById("tableBox").style.display = "none";

  document.getElementById("searchInput").value = "";
  tbody.innerHTML = "";
}

/* FETCH DATA */
function fetchData() {
  tbody.innerHTML = "<tr><td colspan='5'>Loading...</td></tr>";

  fetch(excelUrl)
    .then(r => r.arrayBuffer())
    .then(data => {
      const wb = XLSX.read(data, { type: "array" });
      const sheet = wb.Sheets[wb.SheetNames[0]];
      const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });

      allRows = json.slice(1);

      if (allRows.length === 0) {
        tbody.innerHTML =
          "<tr><td colspan='5'>Results not uploaded yet</td></tr>";
        return;
      }

      render(allRows, true);
      updateScrollSpeed();
    })
    .catch(() => {
      tbody.innerHTML =
        "<tr><td colspan='5'>Unable to load data</td></tr>";
    });
}

/* RENDER */
function render(rows, duplicate) {
  tbody.innerHTML = "";
  rows.forEach(addRow);
  if (duplicate) rows.forEach(addRow);
}

function addRow(row) {
  const tr = document.createElement("tr");

  row.forEach((cell, i) => {
    const td = document.createElement("td");
    const text = (cell || "").toString();
    td.textContent = text || "-";

    if (i === 4) {
      const t = text.toUpperCase();
      if (t === "G" || t.includes("GRANTED")) td.className = "granted";
      else if (t === "R" || t.includes("REJECTED")) td.className = "rejected";
      else td.className = "pending";
    }

    tr.appendChild(td);
  });

  tbody.appendChild(tr);
}

/* SCROLL SPEED */
function updateScrollSpeed() {
  const box = document.querySelector(".table-container");
  const duration =
    Math.max(10, (tbody.scrollHeight + box.offsetHeight) / 30);
  tbody.style.setProperty("--scroll-duration", duration + "s");
}

/* SEARCH */
document.getElementById("searchInput").addEventListener("input", e => {
  const v = e.target.value.toLowerCase();

  if (v) {
    tbody.style.animationPlayState = "paused";
    render(
      allRows.filter(r => r.join(" ").toLowerCase().includes(v)),
      false
    );
  } else {
    tbody.style.animationPlayState = "running";
    render(allRows, true);
  }
});
</script>

</body>
</html>
